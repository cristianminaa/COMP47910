<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
  <meta charset="UTF-8">
  <title>Books Store Cart</title>
  <link rel="icon" type="image/png" th:href="@{/icons8-library-96.png}"/>
  <link rel="stylesheet" th:href="@{/css/main.css}"/>
  <link rel="stylesheet" th:href="@{/css/books.css}"/>
  <link rel="stylesheet" th:href="@{/css/cart.css}"/>
</head>
<body>

<div id="navbar-root" 
     th:data-user-role="${#authorization.expression('hasRole(''ADMIN'')') ? 'ADMIN' : (#authorization.expression('hasRole(''USER'')') ? 'USER' : 'GUEST')}"
     th:data-is-authenticated="${#authorization.expression('isAuthenticated()')}"
     th:data-csrf-token="${_csrf.token}">
</div>


<h1 th:unless="${booksInCart.size() <= 0}">Shopping Cart</h1>
<h1 th:if="${booksInCart.size() <= 0}">Empty Shopping Cart</h1>
<h2 th:if="${booksInCart.size() <= 0}">Add some books to get started.</h2>

<div class="cart-table-container" th:if="${booksInCart.size() > 0}">
  <div class="cart-table-wrapper">
    <!-- Error Messages -->
    <div th:if="${error}" class="error-message">
      <p th:text="${error}"></p>
    </div>
    <table class="cart-table">
      <thead>
      <tr>
        <th>
          <label for="select-all"></label><input type="checkbox" id="select-all"/>
        </th>
        <th>Title</th>
        <th>Authors</th>
        <th>Year</th>
        <th>Price</th>
        <th>Quantity</th>
        <th>Actions</th>
      </tr>
      </thead>
      <tbody>
      <tr th:each="book : ${booksInCart}">
        <td>
          <label>
            <input type="checkbox" name="selectedBooks" th:value="${book.key.id}"/>
          </label>
        </td>
        <td>
          <div class="cart-book-main">
            <div class="cart-book-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 80" fill="none" stroke="#2563eb"
                   stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                <path d="M8 10 Q24 4 32 20 V68 Q24 52 8 58 Z" fill="none"/>
                <path d="M56 10 Q40 4 32 20 V68 Q40 52 56 58 Z" fill="none"/>
                <path d="M12 26 h14 M12 32 h13 M12 38 h14 M12 44 h12" stroke="#2563eb" stroke-width="1.4"/>
                <path d="M38 26 h14 M38 32 h13 M38 38 h14 M38 44 h12" stroke="#2563eb" stroke-width="1.4"/>
              </svg>
            </div>
            <span class="cart-book-title" th:text="${book.key.title}">Book Title</span>
          </div>
        </td>
        <td>
          <span class="cart-book-author" th:text="${book.key.getAuthorNames()}">Authors</span>
        </td>
        <td><span class="cart-book-year" th:text="${book.key.year}">Year</span></td>
        <td>
          <span class="cart-book-price"
                th:text="'$' + (${book.key.price == book.key.price.intValue()} ? ${book.key.price.intValue()} : ${#numbers.formatDecimal(book.key.price, 1, 2)})">$19.99</span>
        </td>
        <td class="cart-book-actions">
          <form th:action="@{/cart/update/{id}(id=${book.key.id})}" method="post">
            <input type="hidden" name="_method" value="put"/>
            <label>
              <input type="number" class="cart-book-quantity" name="quantity"
                     th:value="${book.value}"
                     min="0"
                     th:max="${book.key.numberOfCopies}"/>
            </label>
            <button class="edit-button" type="submit" title="Update Quantity">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24"
                   stroke="white">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M12 20h9M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/>
              </svg>
            </button>
          </form>
        </td>
        <td>
          <form th:action="@{/cart/delete/{id}(id=${book.key.id})}" method="post">
            <input type="hidden" name="_method" value="delete"/>
            <button class="delete-button" type="submit"
                    onclick="return confirm('Are you sure you want to remove this book from your cart?')"
                    title="Remove from Cart">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24"
                   stroke="white">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M19 7l-.867 12.142A2 2 0 0 1 16.138 21H7.862a2 2 0 0 1-1.995-1.858L5 7m5 4v6m4-6v6M9 7h6m-7 0a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1"/>
              </svg>
            </button>
          </form>
        </td>
      </tr>
      </tbody>
    </table>
  </div>

  <div class="checkout-actions">
    <form th:action="@{/checkout}" method="post">
      <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
      <button type="submit" class="checkout-button">Proceed to Checkout</button>
    </form>
  </div>

</div>

<div id="footer-root"></div>


<script th:src="@{/js/bundle.js}"></script>
</body>
</html>