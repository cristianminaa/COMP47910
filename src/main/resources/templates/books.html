<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
  <meta charset="UTF-8">
  <title>Books Store Application</title>
  <link rel="icon" type="image/png" th:href="@{/icons8-library-96.png}"/>
  <link rel="stylesheet" th:href="@{/css/main.css}"/>
  <link rel="stylesheet" th:href="@{/css/books.css}"/>
</head>
<body>

<nav class="navbar">
  <div class="navbar-container">
    <a class="navbar-logo" th:href="@{/books}">Bookshop</a>
    <div class="navbar-actions">
      <div th:if="${#authorization.expression('hasRole(''ADMIN'')')}">
        <form th:action="@{/new}" method="get">
          <button class="navbar-button" type="submit">Add Book</button>
        </form>
      </div>
      <div th:if="${#authorization.expression('hasRole(''ADMIN'')')}">
        <form th:action="@{/addAuthor}" method="get">
          <button class="navbar-button" type="submit">Add Author</button>
        </form>
      </div>
      <form th:if="${#authorization.expression('hasRole(''USER'')')}" th:action="@{/cart}" method="get">
        <button class="navbar-button" type="submit">Cart</button>
      </form>
      <form th:if="${#authorization.expression('isAuthenticated()')}" th:action="@{/logout}" method="post">
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
        <button class="navbar-button" type="submit">Log out</button>
      </form>
      <form th:unless="${#authorization.expression('isAuthenticated()')}" th:action="@{/}" method="get">
        <button class="navbar-button" type="submit">Log in</button>
      </form>
    </div>
  </div>
</nav>

<div class="books-header-row">
  <h1>
    <a class="author-books-titles" th:href="@{/books}">Books</a>
  </h1>
  <h1>
    <a class="author-books-titles" th:href="@{/authors}">Authors</a>
  </h1>
</div>

<div th:if="${listBooks.size() <= 0}">
  <h1>No books in the store yet.</h1>
  <h2>Tell the admin to add some books.</h2>
</div>

<div class="books-grid">
  <div class="book-card" th:each="book : ${listBooks}">
    <div class="book-icon">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 80" fill="none" stroke="#2563eb" stroke-width="2.5"
           stroke-linecap="round" stroke-linejoin="round">
        <!-- Left Page -->
        <path d="M8 10 Q24 4 32 20 V68 Q24 52 8 58 Z" fill="none"/>
        <!-- Right Page -->
        <path d="M56 10 Q40 4 32 20 V68 Q40 52 56 58 Z" fill="none"/>
        <!-- Neat Scribbles on Left Page -->
        <path d="M12 26 h14 M12 32 h13 M12 38 h14 M12 44 h12" stroke="#2563eb" stroke-width="1.4"/>
        <!-- Neat Scribbles on Right Page -->
        <path d="M38 26 h14 M38 32 h13 M38 38 h14 M38 44 h12" stroke="#2563eb" stroke-width="1.4"/>
      </svg>
    </div>

    <div class="book-info">
      <h3 th:text="${book.title}">Book Title</h3>
      <div class="author-books" th:if="${book.authors != null and !#lists.isEmpty(book.authors)}">
        <div th:each="author : ${book.authors}">
          <span th:text="${author.getFullName()}"></span>
        </div>
      </div>
      <p th:text="'Year: ' + ${book.year}">Year</p>
      <p th:text="'Price: $' + (${book.price == book.price.intValue()} ? ${book.price.intValue()} : ${#numbers.formatDecimal(book.price, 1, 2)})">
        $19.99</p>

      <div class="book-actions">
        <p th:unless="${book.numberOfCopies > 0}" class="no-stock">NO STOCK</p>
        <label>
          <input th:if="${book.numberOfCopies > 0 && #authorization.expression('hasRole(''ADMIN'')')}"
                 type="number" name="quantity" th:value="${book.numberOfCopies}" style="width: 35px;" disabled/>
        </label>
        <form th:if="${book.numberOfCopies > 0 && #authorization.expression('isAuthenticated()') && !#authorization.expression('hasRole(''ADMIN'')')}"
              th:action="@{/cart/{id}(id=${book.id})}" method="post">
          <input type="hidden" name="_csrf" th:value="${_csrf.token}"/>
          <input type="hidden" name="bookId" th:value="${book.id}"/>
          <label>
            <input type="number" name="quantity" min="1" th:max="${book.numberOfCopies}" value="1"
                   style="width: 35px;"/>
          </label>
          <button class="cart-button" type="submit" title="Add to Cart">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 90 90" width="22" height="22" fill="white">
              <g transform="translate(0, 4)">
                <path d="M72.975 58.994H31.855c-1.539 0-2.897-1.005-3.347-2.477L15.199 13.006H3.5C1.567 13.006 0 11.439 0 9.506S1.567 6.006 3.5 6.006h14.289c1.539 0 2.897 1.005 3.347 2.476l13.309 43.512h36.204l10.585-25.191h-6.021c-1.933 0-3.5-1.567-3.5-3.5s1.567-3.5 3.5-3.5H86.5c1.172 0 2.267 0.587 2.915 1.563s0.766 2.212 0.312 3.293L76.201 56.85c-.546 1.299-1.817 2.144-3.226 2.144z"/>
                <circle cx="28.88" cy="74.33" r="6.16"/>
                <circle cx="74.59" cy="74.33" r="6.16"/>
                <path d="M62.278 19.546H52.237V9.506c0-1.933-1.567-3.5-3.5-3.5s-3.5 1.567-3.5 3.5v10.04h-10.04c-1.933 0-3.5 1.567-3.5 3.5s1.567 3.5 3.5 3.5h10.04v10.04c0 1.933 1.567 3.5 3.5 3.5s3.5-1.567 3.5-3.5v-10.04h10.041c1.933 0 3.5-1.567 3.5-3.5s-1.567-3.5-3.5-3.5z"/>
              </g>
            </svg>
          </button>
        </form>
        <form th:if="${#authorization.expression('hasRole(''ADMIN'')')}" th:action="@{/books/{id}(id=${book.id})}"
              method="get">
          <button class="edit-button" type="submit" title="Edit">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24"
                 stroke="white">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M12 20h9M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/>
            </svg>
          </button>
        </form>
        <form th:if="${#authorization.expression('hasRole(''ADMIN'')')}"
              th:action="@{/books/delete/{id}(id=${book.id})}" method="post">
          <input type="hidden" name="_method" value="delete"/>
          <button class="delete-button" type="submit"
                  onclick="return confirm('Are you sure you want to delete this book?\nThis will remove the book from any associated authors')"
                  title="Delete">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24"
                 stroke="white">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M19 7l-.867 12.142A2 2 0 0 1 16.138 21H7.862a2 2 0 0 1-1.995-1.858L5 7m5 4v6m4-6v6M9 7h6m-7 0a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1"/>
            </svg>
          </button>
        </form>
      </div>
    </div>
  </div>
</div>

<footer class="page-footer">
  <div class="footer-container">
    <p class="footer-text">Â© 2025 Bookshop by Cristian Mina. All rights reserved by UCD.</p>
    <div class="footer-links">
      <a href="https://www.ucd.ie">UCD</a>
      <a href="mailto:cristian-daniel.mina@ucdconnect.ie">Contact</a>
    </div>
  </div>
</footer>

</body>
</html>