<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Books Store Application</title>
  <link rel="icon" type="image/png" th:href="@{/icons8-library-96.png}"/>
  <link rel="stylesheet" th:href="@{/css/main.css}"/>
  <link rel="stylesheet" th:href="@{/css/books.css}"/>
</head>
<body>

<nav class="navbar">
  <div class="navbar-container">
    <a class="navbar-logo" th:href="@{/books}">Bookshop</a>
    <div class="navbar-actions">
      <div th:if="${session.user != null and session.user.role.name() == 'ADMIN'}">
        <form th:action="@{/new}" method="get">
          <button class="navbar-button" type="submit">Add Book</button>
        </form>
      </div>
      <div th:if="${session.user != null and session.user.role.name() == 'ADMIN'}">
        <form th:action="@{/addAuthor}" method="get">
          <button class="navbar-button" type="submit">Add Author</button>
        </form>
      </div>
      <form th:if="${session.user != null && session.user.role.name() != 'ADMIN'}" th:action="@{/cart}" method="get">
        <button class="navbar-button" type="submit">Cart</button>
      </form>
      <form th:if="${session.user != null}" th:action="@{/logout}" method="get">
        <button class="navbar-button" type="submit">Log out</button>
      </form>
      <form th:unless="${session.user != null}" th:action="@{/}" method="get">
        <button class="navbar-button" type="submit">Log in</button>
      </form>
    </div>
  </div>
</nav>

<div class="books-header-row">
  <h1>
    <a class="author-books-titles" th:href="@{/books}">Books</a>
  </h1>
  <h1>
    <a class="author-books-titles" th:href="@{/authors}">Authors</a>
  </h1>
</div>

<div th:if="${listAuthors.size() <= 0}">
  <h1>No authors in the store yet.</h1>
  <h2>Tell the admin to add some authors.</h2>
</div>

<div class="books-grid">
  <div class="book-card" th:each="author : ${listAuthors}">
    <div class="book-icon">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 80" fill="none" stroke="#2563eb" stroke-width="2.5"
           stroke-linecap="round" stroke-linejoin="round">
        <!-- Head -->
        <circle cx="32" cy="24" r="12" fill="none"/>
        <!-- Shoulders/Body -->
        <path d="M16 56 Q32 44 48 56 Q32 68 16 56 Z" fill="none"/>
        <!-- Shoulders outline -->
        <path d="M16 56 Q32 64 48 56" fill="none"/>
      </svg>
    </div>

    <div class="book-info">
      <h3 th:text="${author.firstName}">First Name</h3>
      <p th:text="${author.lastName}">Last Name</p>
      <div class="author-books" th:if="${author.books != null and !#lists.isEmpty(author.books)}">
        <span>Books: </span>
        <div class="book-tile" th:each="book : ${author.books}">
          <span th:text="${book.title}">Authored Books</span>
        </div>
      </div>

      <div class="book-actions">
        <form th:if="${session.user != null and session.user.role.name() == 'ADMIN'}"
              th:action="@{/authors/{id}(id=${author.id})}" method="get">
          <button class="edit-button" type="submit" title="Edit">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24"
                 stroke="white">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M12 20h9M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/>
            </svg>
          </button>
        </form>
        <form th:if="${session.user != null and session.user.role.name() == 'ADMIN'}"
              th:action="@{/authors/{id}(id=${author.id})}" method="post">
          <input type="hidden" name="_method" value="delete"/>
          <button class="delete-button" type="submit"
                  onclick="return confirm('Are you sure you want to delete this author?\nThis will remove the author from any associated books')"
                  title="Delete">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24"
                 stroke="white">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M19 7l-.867 12.142A2 2 0 0 1 16.138 21H7.862a2 2 0 0 1-1.995-1.858L5 7m5 4v6m4-6v6M9 7h6m-7 0a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1"/>
            </svg>
          </button>
        </form>
      </div>
    </div>
  </div>
</div>

<footer class="page-footer">
  <div class="footer-container">
    <p class="footer-text">Â© 2025 Bookshop by Cristian Mina. All rights reserved by UCD.</p>
    <div class="footer-links">
      <a href="https://www.ucd.ie">UCD</a>
      <a href="mailto:cristian-daniel.mina@ucdconnect.ie">Contact</a>
    </div>
  </div>
</footer>

</body>
</html>